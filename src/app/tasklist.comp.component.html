<div class="vbox">

  <!--------- TABLE WITH TOOLBARS AND ELEMENTS  ---->

  <div class="row header">

  <!--------- TOOLBAR  ---->

  <table class=toolbar>
      <tr>
        <td>
          <button type="button" class=toggleOff [class.toggleOn]="newTaskToggle" (click)="toggleNewTaskBar()">New Task</button>
          <button type="button" class=toolbar disabled>Search</button>
          |
          <button type="button"  class=toolbar [disabled]="TL.countSelIf(applyFilter)==0" (click)="reassignSelectedTasks (reassignTo )">Reassign to:</button>
          <select required [(ngModel)]='reassignTo'>
      <option *ngFor="let item of [].constructor(Parameters['users'].length); let i = index" [value]="i">{{Parameters['users'][i]}}</option>
      </select>
          &nbsp;
          <button type="button"  class=toolbar [disabled]="TL.countSelIf(applyFilter)==0" (click)="changeDueDateOnSelectedTasks (toDueDate)">Change Due date to:</button>
          <input type="date" class=input_inlined style="width:120px"
        [ngModel]="toDueDate | date:'yyyy-MM-dd'"  (ngModelChange)="toDueDate=$event">
          &nbsp;
          <button type="button"  class=toolbar [disabled]="TL.countSelIf(applyFilter)==0" (click)="deleteSelectedTasksButton(1)">Delete</button>
        </td>
      </tr>
    </table>

<!--------- ELEMENTS TABLE  ---->

    <table>

      <!--------- FIELDS NAME  ---->

      <tr class=header>
        <td width=25><input type="checkbox" (change)="onSelectAll($event)"></td>

        <td *ngFor="let f of visibleFields()" width={{f.Width}}>{{f.FCaption}}</td>

        <td>Actions</td>
      </tr>

      <!--------- New Task ROW  ---->

      <tr class=newitem *ngIf="newTaskToggle">
        <td></td>
        <td><input class=input_inlined id="newdesc"
    [(ngModel)]="newTask.name" placeholder="New task name" size="12"></td>

        <td>
          <select required [(ngModel)]='newTask.owner'>
          <option *ngFor="let item of [].constructor(Parameters['users'].length); let i = index" [value]="i">{{Parameters['users'][i]}}</option>
          </select>
        </td>

        <td><i>{{newTask.getCreatorName()}}</i></td>
        <td><i>{{newTask.getStatusName()}}</i></td>
        <td><i>--Now--</i></td>
        <td><i>Empty</i></td>

        <td><input type="date" class=input_inlined style="width:120px"
        [ngModel]="newTask.dueDate | date:'yyyy-MM-dd'"  (ngModelChange)="newTask.dueDate = $event"></td>

        <td><input class=input_inlined id="newdesc"
    [(ngModel)]="newTask.description" placeholder="Enter the task description" size="45%"></td>
        <td>
          <button type="button"  [disabled]="!isValidNewTask()" (click)="addNewTaskButton()" class=inlined >Create task</button>
          &nbsp;
          <button type="button"  (click)="createNewTaskTemplate()" class=inlined >Clear fields</button>
        </td>
      </tr>

      <!--------- TABLE ELEMENTS  ---->

      <ng-container *ngIf="TL.countIf(applyFilter) > 0; then task_tableelements else no_elements">
      </ng-container>

      <!--------- Non-empty TABLE  ---->

      <ng-template #task_tableelements>
        <ng-container *ngFor="let task of TL.subFilter(applyFilter)">
          <tr *ngIf="applyFilter(task)" class=record (mouseover)="onMouseOver(task)" (mouseout)="onMouseOut(task)" [class.highlight]="isDueTask(task)" [class.selected]="task.selected">


            <!--------- LIST OF FIELDS  ---->

            <td><input type="checkbox" [(ngModel)]="task.selected"></td>

            <!--------- Customizatble FIELDS  ---->

            <td *ngIf="task==focus; else name_no_focus"><input class=input_inlined id="name"
    [(ngModel)]="task.name" placeholder="Edit your name here" size="12"></td>
            <ng-template #name_no_focus><td>&nbsp;{{task.name}}</td></ng-template>

            <td>{{task.getOwnerName()}}</td>
            <td>{{task.getCreatorName()}}</td>
            <td>{{task.getStatusName()}}</td>
            <td>{{task.created | date: 'dd/MM/y'}}</td>
            <td>{{task.resolvedT | date: 'dd/MM/y'}}</td>
            <td>{{getDueDate(task) | date: 'dd/MM/y'}}</td>

            <td *ngIf="task==focus; else description_no_focus"><input class=input_inlined id="desc"
    [(ngModel)]="task.description" placeholder="Edit your description here" size="45%"></td>
            <ng-template #description_no_focus><td>&nbsp;{{task.description}}</td></ng-template>


            <!--------- Action Buttons  ---->

            <td *ngIf="task==focus; else actions_no_focus">
              <button type="button"(click)="deleteSelectedTasksButton(0)" class=inlined >Delete</button>
              <ng-container *ngFor="let action of task.availableActions()">
                &nbsp;
                <button type="button" (click)="task.status = action.nextStatus" class=inlined >{{action.name}}</button>
              </ng-container>
            </td>
            <ng-template #actions_no_focus><td ></td></ng-template>

            <!--------- END LIST OF FIELDS  ---->

          </tr>
        </ng-container>
      </ng-template>

      <!--------- EPTY TABLE  -------->

      <ng-template #no_elements>
        <tr>
          <td></td>
          <td colspan=9><i>No tasks to show </i></td>
        </tr>
      </ng-template>
    </table>
  </div>


  <!--------- VERTICAL FILLER  ---->


  <div class="row content">
  </div>


  <!--------- STATUS BAR  ---->

  <div class="row footer">

    <table class=toolbar>
      <tr height=20px>
        <td>
          Total: {{TL.countIf (this.applyFilter)}} tasks, ({{TL.countSelIf(this.applyFilter)}} selected), {{numDueTasks()}} are due
        </td>
      </tr>
    </table>
  </div>

  <!--------- END  ---->

</div>