<div class="vbox">

  <!--------- TABLE WITH TOOLBARS AND ELEMENTS  ---->

  <div class="row header">

    <!--------- TOOLBAR  ---->

    <table class=toolbar height=18px>
      <tr height=18px>
        <td width=100%>

          <table class=toolbar_tabs height=18px width=100%>
            <tr>

              <td width=10px style="border-bottom: none"></td>
              <td width=90px class=toolbar_tab>
                <button class="toolbar_tab" (click)="openToolbarTab($event, '10')" id="ToolBar_List">&nbsp;<span style="color:#ddd000;">&#11201;</span> {{Parameters["DBName"]}}</button>
              </td>
              <td width=2px style="border-bottom: none"></td>
              <td width=90px class=toolbar_tab>
                <button class="toolbar_tab" (click)="openToolbarTab($event, '11')" id="ToolBar_Item">&nbsp;<span style="color:#ddd000;">&#11201;</span> {{Parameters["DBRecordName"]}}</button>
              </td>
              <td width=2px style="border-bottom: none"></td>
              <td width=90px class=toolbar_tab>
                <button class="toolbar_tab" (click)="openToolbarTab($event, '12')"  id="ToolBar_View">&nbsp;üëÅ View</button>
              </td>
              <!--
        <td width=90px class=toolbar_tab style="background-color: #888888;">&nbsp;üëÅ&nbsp;View</td>
-->
              <td style="border-bottom: none"></td>
            </tr>
          </table>

        </td>
      </tr>

      <!-- /// TOOLBAR TABS -->

      <tr height=70px><td>

          <!-- /// DB PROPERTIES TOOLBAR-->

          <div id="DBProps" class="toolbartabcontent" style="display:block">
            <button type="button" class=toggleOff [class.toggleOn]="newTaskToggle" (click)="toggleNewTaskBar()">
              New {{Parameters["DBRecordName"]}}</button>
            <button type="button" class=toolbar disabled>Search</button>
            |
            <button type="button"  class=toolbar [disabled]="TL.countSelIf(applyFilter)==0" (click)="deleteSelectedTasksButton(1)">Delete</button>
          </div>

          <!-- /// DB RECORD PROPERTIES TOOLBAR-->

          <div id="DBRecProps" class="toolbartabcontent" style="display:block">
          <table height=100%><tr><td class="toolbar_section" width=80px>

            <div class="toolbar_section_title">Classification</div>
            <div class="colFmt"><span>Class:</span><span style="font-weight: bold ">{{op_classname}}</span></div><br>
            <div class="colFmt"><span>Type:</span><span>Task</span></div>
            <br>

            </td><td class="toolbar_section" width=165px>
            <div class="toolbar_section_title" style="background-color: #cccccc;">Milestones</div>
            <table class="toolbar_inlined" width=160px><tr>
              <td class="toolbar_header_cell" width=40px>Created</td>
              <td class="toolbar_inlined_cell"> {{ (op_creator==-1)?"none":Parameters['users'][op_creator] }}</td>
              <td class="toolbar_inlined_cell">{{op_createdT | date: 'dd/MM/y'}}</td>
            </tr><tr>
              <td class="toolbar_header_cell">Resolved</td>
              <td class="toolbar_inlined_cell"> </td>
              <td class="toolbar_inlined_cell">{{op_resolvedT | date: 'dd/MM/y'}}</td>
            </tr><tr>
              <td class="toolbar_header_cell">Closed</td>
              <td class="toolbar_inlined_cell"> </td>
              <td class="toolbar_inlined_cell">{{op_closedT | date: 'dd/MM/y'}}</td>
            </tr></table>

            </td><td class="toolbar_section">
<!--            <button type="button"  class=toolbar [disabled]="TL.countSelIf(applyFilter)==0" (click)="reassignSelectedTasks (op_owner )">Reassign to:</button>-->
            <span style = "vertical-align: top;">Name: </span>
            <input class="toolbar" style = "vertical-align: top;"
    [(ngModel)]="op_name" placeholder="Name for selected" size="12" (change)="renameSelectedTasks()" [disabled]="TL.countSelIf(applyFilter)==0"><br><br>
            <span style = "vertical-align: top;">Owner: </span>
            <select class="toolbarbox" required size=2 [(ngModel)]='op_owner' [disabled]="TL.countSelIf(applyFilter)==0" >
      <option *ngFor="let item of [].constructor(Parameters['users'].length); let i = index" [value]="i" (click)="onChangeOwner()">{{Parameters['users'][i]}}</option>
      </select>
            &nbsp;
            </td><td class="toolbar_section" width="150px">
            <span style = "vertical-align: top;">Status: </span><span style="font-weight: bold " ng-bind-html="getSelectedStatusName()">{{getSelectedStatusName()}}</span><br>
            Flow actions:<br>
            <ng-container *ngIf="numSelected()>0 && op_status>=0">
              <ng-container *ngFor="let action of commonAvailableActions()" > 
                &nbsp;&nbsp;<button type="button" (click)="doActionTasks( action.nextStatus)" class=inlined >{{action.name}}</button><br>
              </ng-container>
            </ng-container>


          </td><td class="toolbar_section" width="180px">
            <span style = "vertical-align: top;">Description: </span><br>
            <input class="toolbar" style = "vertical-align: top;"
    [(ngModel)]="sel.description" placeholder="Enter description here" size="30" *ngIf="checkOneSelectedTask()">
            </td><td class="toolbar_section">
<!--            <button type="button"  class=toolbar [disabled]="TL.countSelIf(applyFilter)==0" (click)="changeDueDateOnSelectedTasks (toDueDate)">Change Due date to:</button>-->
         <div class="toolbar_section_title">{{Parameters["DBRecordName"]}}  specific</div>
         <span style = "vertical-align: top;">Due date: </span>   <input type="date" class=input_inlined style="width:120px"
        [ngModel]="toDueDate | date:'yyyy-MM-dd'"  (ngModelChange)="toDueDate=$event; changeDueDateOnSelectedTasks (toDueDate)" [disabled]="TL.countSelIf(applyFilter)==0">

          </td><td>
          </td></tr></table>
          </div>

          <!-- /// VIEW PROPERTIES TOOLBAR-->

          <div id="ViewProps" class="toolbartabcontent" style="display:block">
          &nbsp;<input type="checkbox" [(ngModel)]="vw_showTerminalTasks" (change)="vw_toggleTerminalTasks($event)">Show completed tasks<br>
          &nbsp;<input type="checkbox" [(ngModel)]="vw_showHeaders" >Show headers<br>
          &nbsp;<input type="checkbox" [(ngModel)]="vw_showGrid" >Show grid<br>

          
          </div>
          <!-- /// END OF TOOLBAR TABS-->
       </td>
      </tr>
    </table>


    <!--------- ELEMENTS TABLE  ---->

    <table width=100%>

      <!--------- FIELDS NAME  ---->

      <tr *ngIf="vw_showHeaders" class=header>
        <td width="25px"><input type="checkbox" (change)="onSelectAll($event)"></td>

        <td *ngFor="let f of visibleFields()" width={{f.Width}}>{{f.FCaption}}</td>

        <td>Actions</td>
      </tr>

      <!--------- New Task ROW  ---->

      <tr class=newitem *ngIf="newTaskToggle">
        <td width="25px"></td>
        <td><input class=input_inlined 
    [(ngModel)]="newTask.name" placeholder="New task name" size="12"></td>

        <td>
          <select required [(ngModel)]='newTask.owner'>
          <option *ngFor="let item of [].constructor(Parameters['users'].length); let i = index" [value]="i">{{Parameters['users'][i]}}</option>
          </select>
        </td>

        <td><i>{{newTask.getCreatorName()}}</i></td>
        <td><i>{{newTask.getStatusName()}}</i></td>
        <td><i>--Now--</i></td>
        <td><i>Empty</i></td>

        <td><input type="date" class=input_inlined style="width:120px"
        [ngModel]="newTask.dueDate | date:'yyyy-MM-dd'"  (ngModelChange)="newTask.dueDate = $event"></td>

        <td><input class=input_inlined 
    [(ngModel)]="newTask.description" placeholder="Enter the task description" size="45%"></td>
        <td>
          <button type="button"  [disabled]="!isValidNewTask()" (click)="addNewTaskButton()" class=inlined >Create task</button>
          &nbsp;
          <button type="button"  (click)="createNewTaskTemplate()" class=inlined >Clear fields</button>
        </td>
      </tr>


      <tr class=newitem *ngIf="newTaskToggle">
        <td width="25px"></td>


        <td *ngFor="let f of visibleFields()" width={{f.Width}}  [class.grid] = "vw_showGrid">
          <div [ngSwitch]="newTask.getFieldType(f.FName)">

            <ng-container *ngSwitchCase="'string'">
              <ng-container *ngIf="f.Access == 'ro'; else newrec_string_rw"> 
              {{newTask.getFieldValue(f.FName)}}
              </ng-container>
              <ng-template #newrec_string_rw>
                <input #newrec_text class=input_inlined 
    (change)="newTask.setFieldValue(f.FName,newrec_text.value)" placeholder={{f.FCaption}} size={{f.Width}}>
              </ng-template>


            </ng-container>

            <ng-container *ngSwitchCase="'date'">{{newTask.getFieldValue(f.FName) | date: 'dd/MM/y'}}</ng-container>

            <ng-container *ngSwitchDefault> {{newTask.getFieldValue(f.FName)}}</ng-container>

          </div>
        </td>

<!--

        <td><input class=input_inlined 
    [(ngModel)]="newTask.name" placeholder="New task name" size="12"></td>

        <td>
          <select required [(ngModel)]='newTask.owner'>
          <option *ngFor="let item of [].constructor(Parameters['users'].length); let i = index" [value]="i">{{Parameters['users'][i]}}</option>
          </select>
        </td>

        <td><i>{{newTask.getCreatorName()}}</i></td>
        <td><i>{{newTask.getStatusName()}}</i></td>
        <td><i>--Now--</i></td>
        <td><i>Empty</i></td>

        <td><input type="date" class=input_inlined style="width:120px"
        [ngModel]="newTask.dueDate | date:'yyyy-MM-dd'"  (ngModelChange)="newTask.dueDate = $event"></td>

        <td><input class=input_inlined 
    [(ngModel)]="newTask.description" placeholder="Enter the task description" size="45%"></td>

-->

        <td>
          <button type="button"  [disabled]="!isValidNewTask()" (click)="addNewTaskButton()" class=inlined >Create task</button>
          &nbsp;
          <button type="button"  (click)="createNewTaskTemplate()" class=inlined >Clear fields</button>
        </td>

      </tr>

      <!--------- TABLE ELEMENTS  ---->

      <ng-container *ngIf="TL.countIf(applyFilter) > 0; then task_tableelements else no_elements">
      </ng-container>

      <!--------- Non-empty TABLE  ---->

      <ng-template #task_tableelements>
        <ng-container *ngFor="let task of TL.subFilter(applyFilter)">
          <tr *ngIf="applyFilter(task)" class=record (mouseover)="onMouseOver(task)" (mouseout)="onMouseOut(task)"
            [class.highlight]="isDueTask(task)" [class.selected]="task.selected">


            <!--------- LIST OF FIELDS  ---->

            <td width="25px" [class.grid] = "vw_showGrid"><input type="checkbox" (change)="onSelectRecord($event, task)" [(ngModel)]="task.selected" ></td>

            <!--------- Customizatble FIELDS  ---->
<!--
            <td *ngIf="task==focus; else name_no_focus"><input class=input_inlined id="name"
    [(ngModel)]="task.name" placeholder="Edit your name here" size="12"></td>
            <ng-template #name_no_focus>
              <td>&nbsp;{{task.name}}</td>
            </ng-template>
-->

        <td *ngFor="let f of visibleFields()" width={{f.Width}}  [class.grid] = "vw_showGrid">
          <div [ngSwitch]="task.getFieldType(f.FName)">
            <ng-container *ngSwitchCase="'date'">{{task.getFieldValue(f.FName) | date: 'dd/MM/y'}}</ng-container>
            <ng-container *ngSwitchDefault> {{task.getFieldValue(f.FName)}}</ng-container>
          </div>
        </td>

<!--
        <td *ngFor="let f of visibleFields()" width={{f.Width}} >
          <div *ngIf="task.getFieldType(f.FName) == 'date'">
          {{task.getFieldValue(f.FName) | date: 'dd/MM/y'}}
          </div>
          <div *ngIf="task.getFieldType(f.FName) != 'date'">
          {{task.getFieldValue(f.FName)}}
          </div>
        </td>
-->

<!--
            <td>{{task.name}}</td>
            <td>{{task.getOwnerName()}}</td>
            <td>{{task.getCreatorName()}}</td>
            <td>{{task.getStatusName()}}</td>
            <td>{{task.created | date: 'dd/MM/y'}}</td>
            <td>{{task.resolvedT | date: 'dd/MM/y'}}</td>
            <td>{{getDueDate(task) | date: 'dd/MM/y'}}</td>
            <td>{{task.description}}</td>
-->
<!--
            <td *ngIf="task==focus; else description_no_focus"><input class=input_inlined id="desc"
    [(ngModel)]="task.description" placeholder="Edit your description here" size="45%"></td>
            <ng-template #description_no_focus>
              <td>&nbsp;{{task.description}}</td>
            </ng-template>
-->


            <!--------- Action Buttons  ---->

            <td *ngIf="task==focus; else actions_no_focus"  [class.grid] = "vw_showGrid">
              <button type="button"(click)="deleteSelectedTasksButton(0)" class=inlined >Delete</button>
              <ng-container *ngFor="let action of task.availableActions()">
                &nbsp;
                <button type="button" (click)="task.status = action.nextStatus; selectedSummary(null) " class=inlined >{{action.name}}</button>
              </ng-container>
            </td>
            <ng-template #actions_no_focus>
              <td [class.grid] = "vw_showGrid"></td>
            </ng-template>

            <!--------- END LIST OF FIELDS  ---->

          </tr>
        </ng-container>
      </ng-template>

      <!--------- EPTY TABLE  -------->

      <ng-template #no_elements>
        <tr>
          <td></td>
          <td colspan=9><i>No tasks to show </i></td>
        </tr>
      </ng-template>

    </table>
  </div>


  <!--------- VERTICAL FILLER  ---->


  <div class="row content">
  </div>


  <!--------- STATUS BAR  ---->

  <div class="row footer">

    <table class=toolbar>
      <tr height=20px>
        <td>
          Total: {{TL.countIf (this.applyFilter)}} tasks, ({{numSelected()}} selected),
          {{numDueTasks()}} are due <!--,  {{selectedSum()["ClassName"]}} name-->
        </td>
      </tr>
    </table>
  </div>

  <!--------- END  ---->

</div>